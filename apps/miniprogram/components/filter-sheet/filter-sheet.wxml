<!--components/filter-sheet/filter-sheet.wxml-->
<view wx:if="{{visible}}" class="filter-sheet-overlay" bindtap="onClose">
  <view class="filter-sheet" catchtap>
    <!-- 头部 -->
    <view class="filter-header">
      <text class="filter-title">筛选条件</text>
      <view class="filter-actions">
        <text class="reset-btn" bindtap="onReset">重置</text>
        <text class="close-btn" bindtap="onClose">✕</text>
      </view>
    </view>

    <!-- 筛选内容 -->
    <scroll-view class="filter-content" scroll-y="true">
      <view wx:for="{{schema}}" wx:key="key" class="filter-section">
        <text class="filter-label">{{item.label}}</text>
        
        <!-- 范围类型 -->
        <view wx:if="{{item.type === 'range'}}" class="filter-range">
          <view class="range-values">
            <text class="range-text">{{internalValues[item.key].min}}{{item.unit || ''}}</text>
            <text class="range-separator">-</text>
            <text class="range-text">{{internalValues[item.key].max}}{{item.unit || ''}}</text>
          </view>
          <slider 
            class="range-slider"
            data-key="{{item.key}}"
            min="{{item.min}}"
            max="{{item.max}}"
            step="{{item.step || 1}}"
            value="{{sliderValues[item.key][0]}}"
            bindchange="onRangeChange"
            show-value="{{false}}"
            range="{{true}}"
            range-value="{{sliderValues[item.key]}}"
          />
        </view>

        <!-- 多选类型 -->
        <view wx:elif="{{item.type === 'multi'}}" class="filter-multi">
          <view 
            wx:for="{{item.options}}" 
            wx:for-item="option"
            wx:for-index="optionIndex"
            wx:key="{{option.value || option}}"
            class="multi-option {{option.disabled ? 'disabled' : ''}} {{internalValues[item.key].includes(option.value || option) ? 'selected' : ''}}"
            data-key="{{item.key}}"
            data-option="{{option.value || option}}"
            bindtap="{{option.disabled ? '' : 'onMultiToggle'}}"
          >
            <text class="option-text">{{option.label || option}}</text>
            <text wx:if="{{option.note}}" class="option-note">{{option.note}}</text>
            <text wx:if="{{internalValues[item.key].includes(option.value || option)}}" class="option-check">✓</text>
          </view>
        </view>

        <!-- 布尔类型 -->
        <view wx:elif="{{item.type === 'bool'}}" class="filter-bool">
          <view 
            class="bool-option {{internalValues[item.key] ? 'selected' : ''}}"
            data-key="{{item.key}}"
            bindtap="onBoolToggle"
          >
            <text class="option-text">{{item.label}}</text>
            <text wx:if="{{internalValues[item.key]}}" class="option-check">✓</text>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- 底部操作 -->
    <view class="filter-footer">
      <button class="apply-btn" bindtap="onApply">
        应用筛选
        <text wx:if="{{getActiveFiltersCount() > 0}}" class="filter-count">({{getActiveFiltersCount()}})</text>
      </button>
    </view>
  </view>
</view>