<!--pages/category/category.wxml-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">å•†å“åˆ†ç±»</text>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-bar">
      <text class="search-icon">ğŸ”</text>
      <text class="search-placeholder">æœç´¢å•†å“æˆ–å“ç‰Œ</text>
      <text class="barcode-icon">ğŸ“±</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error">
    <text>{{error}}</text>
    <button class="btn-primary" bindtap="onRetry">é‡è¯•</button>
  </view>

  <!-- åˆ†ç±»å†…å®¹ -->
  <view wx:else class="category-content">
    <!-- éƒ¨é—¨åˆ†ç±»æ ‡é¢˜ -->
    <view class="section-header">
      <text class="section-title">Shop by Department</text>
    </view>

    <!-- éƒ¨é—¨ç½‘æ ¼ -->
    <view class="department-grid">
      <view 
        wx:for="{{departments}}" 
        wx:key="id" 
        class="department-card"
        data-department="{{item}}"
        bindtap="onDepartmentTap"
      >
        <image class="department-image" src="{{item.image}}" mode="aspectFill"></image>
        <view class="department-overlay">
          <text class="department-name">{{item.name}}</text>
        </view>
      </view>
    </view>

    <!-- ä¼ ç»Ÿåˆ†ç±»éƒ¨åˆ† -->
    <view class="traditional-categories">
      <!-- å·¦ä¾§åˆ†ç±»åˆ—è¡¨ -->
      <view class="category-sidebar">
        <view 
          wx:for="{{categories}}" 
          wx:key="id" 
          class="category-tab {{selectedCategory && selectedCategory.id === item.id ? 'active' : ''}}"
          data-category="{{item}}"
          bindtap="onCategoryTap"
        >
          <text class="category-tab-name">{{item.name}}</text>
          <text class="category-tab-count">({{item.count}})</text>
        </view>
      </view>

      <!-- å³ä¾§å•†å“ç½‘æ ¼ -->
      <view class="category-main">
        <view wx:if="{{selectedCategory}}" class="category-header">
          <text class="category-title">{{selectedCategory.name}}</text>
          <text class="view-all" bindtap="onViewAllTap">
            æŸ¥çœ‹å…¨éƒ¨ >
          </text>
        </view>
        
        <!-- å•†å“åŠ è½½çŠ¶æ€ -->
        <view wx:if="{{itemsLoading}}" class="items-loading">
          <text>åŠ è½½å•†å“ä¸­...</text>
        </view>
        
        <!-- å•†å“ç½‘æ ¼ -->
        <view wx:else class="items-grid">
          <product-card
            wx:for="{{items}}" 
            wx:key="id"
            product="{{item}}"
            card-type="grid"
            show-favorite="{{true}}"
            bind:cardtap="onProductCardTap"
            bind:favoritechange="onFavoriteChange"
          />
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view wx:if="{{!itemsLoading && items.length === 0}}" class="empty-state">
          <text class="empty-text">è¯¥åˆ†ç±»æš‚æ— å•†å“</text>
          <text class="empty-desc">è¯•è¯•å…¶ä»–åˆ†ç±»å§</text>
        </view>
      </view>
    </view>
  </view>
</view>
