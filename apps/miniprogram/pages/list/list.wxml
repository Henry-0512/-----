<!--pages/list/list.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="page-header">
    <view class="nav-back" bindtap="onGoBack">
      <text class="back-icon">â€¹</text>
    </view>
    <text class="page-title">{{pageTitle || 'å•†å“åˆ—è¡¨'}}</text>
    <view class="nav-placeholder"></view>
  </view>

  <!-- ç­›é€‰æ§åˆ¶æ  -->
  <view class="filter-controls">
    <view class="control-button" bindtap="onShowSort">
      <text class="control-text">æ’åº</text>
      <text class="control-arrow">âŒ„</text>
    </view>
    <view class="control-button {{hasActiveFilters ? 'active' : ''}}" bindtap="onShowFilter">
      <text class="control-text">ç­›é€‰</text>
      <text wx:if="{{hasActiveFilters}}" class="filter-count">({{filterCount}})</text>
    </view>
  </view>

  <!-- æ’åºçŠ¶æ€æ˜¾ç¤º -->
  <view wx:if="{{currentSort !== 'newest'}}" class="sort-status">
    <text class="sort-text">
      å½“å‰æ’åºï¼š{{sortOptions.find(item => item.key === currentSort).name}}
    </text>
  </view>

  <!-- éª¨æ¶å±åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading && items.length === 0}}" class="skeleton">
    <view class="skeleton-header"></view>
    <view class="skeleton-filters">
      <view class="skeleton-filter-btn"></view>
      <view class="skeleton-filter-btn"></view>
    </view>
    <view class="skeleton-products">
      <view wx:for="{{[1,2,3,4,5,6]}}" wx:key="*this" class="skeleton-product"></view>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-state">
    <view class="error-icon">âŒ</view>
    <text class="error-message">{{error.message}}</text>
    <button wx:if="{{error.canRetry}}" class="retry-btn" bindtap="onRetryLoad">é‡è¯•</button>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:elif="{{isEmpty}}" class="empty-state">
    <view class="empty-icon">ğŸ”</view>
    <text class="empty-message">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å•†å“</text>
    <text class="empty-desc">è¯•è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶</text>
    <button class="retry-btn" bindtap="onRetryLoad">é‡æ–°æœç´¢</button>
  </view>

  <!-- æœ‰æ•°æ®æ—¶æ˜¾ç¤ºå†…å®¹ -->
  <view wx:else>
    <!-- ç»“æœç»Ÿè®¡ -->
    <view class="result-info">
      <text class="result-text">
        å…±æ‰¾åˆ° {{total}} ä¸ªç»“æœ
        <text wx:if="{{searchQuery}}" class="search-keyword">"{{searchQuery}}"</text>
      </text>
    </view>

    <!-- å•†å“åˆ—è¡¨ - 2åˆ—ç½‘æ ¼å¸ƒå±€ -->
    <view class="items-grid">
      <product-card
        wx:for="{{items}}" 
        wx:key="id"
        product="{{item}}"
        card-type="grid"
        show-favorite="{{true}}"
        bind:cardtap="onProductCardTap"
        bind:favoritechange="onFavoriteChange"
      />
    </view>

    <!-- åº•éƒ¨åŠ è½½æ›´å¤š -->
    <view wx:if="{{loading && items.length > 0}}" class="load-more">
      <text>åŠ è½½æ›´å¤š...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view wx:elif="{{!hasMore && items.length > 0}}" class="no-more">
      <text>â€” å·²æ˜¾ç¤ºå…¨éƒ¨å•†å“ â€”</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{items.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“¦</text>
      <text class="empty-text">
        {{searchQuery ? 'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å•†å“' : 'æš‚æ— å•†å“'}}
      </text>
      <text class="empty-desc">
        {{searchQuery ? 'è¯•è¯•ä¿®æ”¹æœç´¢å…³é”®è¯' : 'è¯·ç¨åå†è¯•'}}
      </text>
    </view>
  </view>

  <!-- æ–°ç‰ˆç­›é€‰æŠ½å±‰ -->
  <filter-sheet
    visible="{{showFilterSheet}}"
    schema="{{filterSchema}}"
    values="{{currentFilters}}"
    bind:apply="onFilterApply"
    bind:close="onFilterClose"
  />
</view>
