<!--pages/list/list.wxml-->
<view class="container">
  <!-- èƒŒæ™¯å›¾ç‰‡åŒºåŸŸ -->
  <view class="hero-section">
    <image 
      class="hero-image" 
      src="https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=800&h=300&fit=crop"
      mode="aspectFill"
    />
    <view class="hero-overlay">
      <view class="nav-header">
        <view class="nav-back" bindtap="onGoBack">
          <text class="back-arrow">â†</text>
        </view>
        <view class="nav-placeholder"></view>
      </view>
      <text class="hero-title">New at HomeNest</text>
    </view>
  </view>

  <!-- IKEAé£æ ¼ç­›é€‰æ  -->
  <view class="ikea-filter-bar">
    <!-- å¿«é€Ÿç­›é€‰æ ‡ç­¾ -->
    <scroll-view class="filter-tags" scroll-x="{{true}}" show-scrollbar="{{false}}">
      <view class="filter-tag {{currentSort === 'rent_desc' ? 'active' : ''}}" bindtap="onQuickFilter" data-type="best">
        <text class="tag-text">Best match</text>
      </view>
      <view class="filter-tag" bindtap="onQuickFilter" data-type="category">
        <text class="tag-text">Category</text>
      </view>
      <view class="filter-tag" bindtap="onQuickFilter" data-type="size">
        <text class="tag-text">Size</text>
      </view>
      <view class="filter-tag" bindtap="onQuickFilter" data-type="color">
        <text class="tag-text">Color</text>
      </view>
      <view class="filter-tag" bindtap="onQuickFilter" data-type="style">
        <text class="tag-text">Style</text>
      </view>
      <view class="filter-tag" bindtap="onQuickFilter" data-type="price">
        <text class="tag-text">Price</text>
      </view>
    </scroll-view>
    
    <!-- ç­›é€‰æŒ‰é’® -->
    <view class="filter-button" bindtap="onShowFilter">
      <text class="filter-icon">âš™</text>
      <text wx:if="{{hasActiveFilters}}" class="filter-badge">{{filterCount}}</text>
    </view>
  </view>

  <!-- å•†å“æ•°é‡å’Œè§†å›¾åˆ‡æ¢ -->
  <view class="products-header">
    <text class="products-count">{{totalCount || items.length}} Products</text>
    <view class="view-toggle">
      <view class="toggle-btn active">
        <text class="toggle-icon">âŠ</text>
      </view>
      <view class="toggle-btn">
        <text class="toggle-icon">â˜°</text>
      </view>
    </view>
  </view>

  <!-- é‚®ç¼–å’Œé—¨åº—é€‰æ‹© -->
  <view class="location-bar">
    <view class="location-item" bindtap="onSelectPostcode">
      <text class="location-icon">ğŸšš</text>
      <text class="location-text">Select post code</text>
    </view>
    <view class="location-item" bindtap="onSelectStore">
      <text class="location-icon">ğŸª</text>
      <text class="location-text">Select store</text>
    </view>
  </view>

  <!-- éª¨æ¶å±åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading && items.length === 0}}" class="skeleton">
    <view class="skeleton-header"></view>
    <view class="skeleton-filters">
      <view class="skeleton-filter-btn"></view>
      <view class="skeleton-filter-btn"></view>
    </view>
    <view class="skeleton-products">
      <view wx:for="{{[1,2,3,4,5,6]}}" wx:key="*this" class="skeleton-product"></view>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-state">
    <view class="error-icon">âŒ</view>
    <text class="error-message">{{error.message}}</text>
    <button wx:if="{{error.canRetry}}" class="retry-btn" bindtap="onRetryLoad">é‡è¯•</button>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:elif="{{isEmpty}}" class="empty-state">
    <view class="empty-icon">ğŸ”</view>
    <text class="empty-message">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å•†å“</text>
    <text class="empty-desc">è¯•è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶</text>
    <button class="retry-btn" bindtap="onRetryLoad">é‡æ–°æœç´¢</button>
  </view>

  <!-- æœ‰æ•°æ®æ—¶æ˜¾ç¤ºå†…å®¹ -->
  <view wx:else>
    <!-- ç»“æœç»Ÿè®¡ -->
    <view class="result-info">
      <text class="result-text">
        å…±æ‰¾åˆ° {{total}} ä¸ªç»“æœ
        <text wx:if="{{searchQuery}}" class="search-keyword">"{{searchQuery}}"</text>
      </text>
    </view>

    <!-- å•†å“åˆ—è¡¨ - 2åˆ—ç½‘æ ¼å¸ƒå±€ -->
    <view class="items-grid">
      <product-card
        wx:for="{{items}}" 
        wx:key="id"
        product="{{item}}"
        card-type="grid"
        show-favorite="{{true}}"
        bind:cardtap="onProductCardTap"
        bind:favoritechange="onFavoriteChange"
      />
    </view>

    <!-- åº•éƒ¨åŠ è½½æ›´å¤š -->
    <view wx:if="{{loading && items.length > 0}}" class="load-more">
      <text>åŠ è½½æ›´å¤š...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view wx:elif="{{!hasMore && items.length > 0}}" class="no-more">
      <text>â€” å·²æ˜¾ç¤ºå…¨éƒ¨å•†å“ â€”</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{items.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“¦</text>
      <text class="empty-text">
        {{searchQuery ? 'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å•†å“' : 'æš‚æ— å•†å“'}}
      </text>
      <text class="empty-desc">
        {{searchQuery ? 'è¯•è¯•ä¿®æ”¹æœç´¢å…³é”®è¯' : 'è¯·ç¨åå†è¯•'}}
      </text>
    </view>
  </view>

  <!-- æ–°ç‰ˆç­›é€‰æŠ½å±‰ -->
  <filter-sheet
    visible="{{showFilterSheet}}"
    schema="{{filterSchema}}"
    values="{{currentFilters}}"
    bind:apply="onFilterApply"
    bind:close="onFilterClose"
  />

  <!-- å•é¡¹ç­›é€‰å™¨ç»„ä»¶ -->
  <single-filter
    visible="{{showSingleFilter}}"
    type="{{singleFilterType}}"
    title="{{singleFilterTitle}}"
    options="{{singleFilterOptions}}"
    selectedValues="{{singleFilterSelected}}"
    bind:apply="onSingleFilterApply"
    bind:close="onSingleFilterClose"
  />
</view>
