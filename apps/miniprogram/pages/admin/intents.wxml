<!--pages/admin/intents.wxml-->
<view class="container">
  <!-- æœªè®¤è¯çŠ¶æ€ -->
  <view wx:if="{{!isAuthenticated}}" class="auth-section">
    <view class="auth-header">
      <text class="auth-title">æ„å‘è®¢å•ç®¡ç†</text>
      <text class="auth-desc">è¯·è¾“å…¥ç®¡ç†å‘˜è®¿é—®ä»¤ç‰Œ</text>
    </view>
    
    <view class="auth-form">
      <view class="input-group">
        <input 
          class="token-input" 
          type="text"
          placeholder="è¯·è¾“å…¥è®¿é—®ä»¤ç‰Œ"
          value="{{inputToken}}"
          bindinput="onTokenInput"
          password="{{true}}"
        />
      </view>
      <button class="auth-btn" bindtap="onAuthenticate">éªŒè¯è®¿é—®</button>
    </view>
    
    <view class="auth-footer">
      <text class="auth-note">æ­¤é¡µé¢ä»…ä¾›ç®¡ç†å‘˜ä½¿ç”¨</text>
    </view>
  </view>

  <!-- å·²è®¤è¯çŠ¶æ€ -->
  <view wx:else class="admin-content">
    <!-- ç®¡ç†å¤´éƒ¨ -->
    <view class="admin-header">
      <view class="header-info">
        <text class="admin-title">æ„å‘è®¢å•ç®¡ç†</text>
        <text class="admin-desc">ç®¡ç†å‘˜æ¨¡å¼</text>
      </view>
      <button class="logout-btn" bindtap="onLogout">é€€å‡º</button>
    </view>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-section">
      <view class="stat-item">
        <text class="stat-number">{{stats.total}}</text>
        <text class="stat-label">æ€»è®¢å•</text>
      </view>
      <view class="stat-item pending">
        <text class="stat-number">{{stats.pending}}</text>
        <text class="stat-label">å¾…å¤„ç†</text>
      </view>
      <view class="stat-item contacted">
        <text class="stat-number">{{stats.contacted}}</text>
        <text class="stat-label">å·²è”ç³»</text>
      </view>
      <view class="stat-item done">
        <text class="stat-number">{{stats.done}}</text>
        <text class="stat-label">å·²å®Œæˆ</text>
      </view>
    </view>

    <!-- çŠ¶æ€ç­›é€‰ -->
    <view class="filter-tabs">
      <view 
        wx:for="{{statusOptions}}" 
        wx:key="key"
        class="filter-tab {{currentStatus === item.key ? 'active' : ''}}"
        data-status="{{item.key}}"
        bindtap="onStatusFilter"
      >
        <text class="tab-text">{{item.name}}</text>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading && orders.length === 0}}" class="loading">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- é”™è¯¯çŠ¶æ€ -->
    <view wx:elif="{{error}}" class="error">
      <text>{{error}}</text>
      <button class="retry-btn" bindtap="onRetry">é‡è¯•</button>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:elif="{{isEmpty}}" class="empty">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— è®¢å•æ•°æ®</text>
    </view>

    <!-- è®¢å•åˆ—è¡¨ -->
    <view wx:else class="orders-list">
      <view 
        wx:for="{{orders}}" 
        wx:key="id"
        class="order-card"
        data-order="{{item}}"
        bindtap="onViewOrder"
      >
        <!-- è®¢å•å¤´éƒ¨ -->
        <view class="order-header">
          <view class="order-info">
            <text class="order-id">{{item.id}}</text>
            <text class="order-time">{{item.createdAt}}</text>
          </view>
          <view class="order-status {{item.status}}">
            <text class="status-text">
              {{item.status === 'pending' ? 'å¾…å¤„ç†' : item.status === 'contacted' ? 'å·²è”ç³»' : 'å·²å®Œæˆ'}}
            </text>
          </view>
        </view>

        <!-- å•†å“ä¿¡æ¯ -->
        <view class="order-product">
          <image class="product-image" src="{{item.sku.image}}" mode="aspectFill"></image>
          <view class="product-info">
            <text class="product-title">{{item.sku.title}}</text>
            <text class="product-brand">{{item.sku.brand}}</text>
            <text class="product-specs">
              {{item.quantity}}ä»¶ Ã— {{item.duration}}{{item.durationUnit === 'week' ? 'å‘¨' : 'æœˆ'}}
            </text>
          </view>
          <view class="product-price">
            <text class="price-amount">Â¥{{item.totalAmount}}</text>
          </view>
        </view>

        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <view wx:if="{{item.userInfo.phone || item.userInfo.name}}" class="order-user">
          <text wx:if="{{item.userInfo.name}}" class="user-name">{{item.userInfo.name}}</text>
          <text wx:if="{{item.userInfo.phone}}" class="user-phone">{{item.userInfo.phone}}</text>
        </view>

        <!-- æ“ä½œæŒ‰é’® -->
        <view class="order-actions">
          <button 
            wx:if="{{item.status === 'pending'}}"
            class="action-btn contacted"
            data-order-id="{{item.id}}"
            data-new-status="contacted"
            bindtap="onUpdateStatus"
            catchtap
          >
            æ ‡è®°å·²è”ç³»
          </button>
          <button 
            wx:if="{{item.status === 'contacted'}}"
            class="action-btn done"
            data-order-id="{{item.id}}"
            data-new-status="done"
            bindtap="onUpdateStatus"
            catchtap
          >
            æ ‡è®°å®Œæˆ
          </button>
          <button 
            wx:if="{{item.status === 'done'}}"
            class="action-btn completed"
            disabled
          >
            å·²å®Œæˆ
          </button>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view wx:if="{{loading && orders.length > 0}}" class="load-more">
        <text>åŠ è½½æ›´å¤š...</text>
      </view>

      <!-- æ²¡æœ‰æ›´å¤š -->
      <view wx:elif="{{!hasMore && orders.length > 0}}" class="no-more">
        <text>â€” å·²æ˜¾ç¤ºå…¨éƒ¨è®¢å• â€”</text>
      </view>
    </view>
  </view>
</view>
