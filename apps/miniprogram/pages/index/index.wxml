<!--pages/index/index.wxml-->
<view class="container">
  <!-- éª¨æ¶å±åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="skeleton">
    <view class="skeleton-search"></view>
    <view class="skeleton-banner"></view>
    <view class="skeleton-categories">
      <view wx:for="{{[1,2,3,4]}}" wx:key="*this" class="skeleton-category"></view>
    </view>
    <view class="skeleton-products">
      <view wx:for="{{[1,2,3,4,5,6]}}" wx:key="*this" class="skeleton-product"></view>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-state">
    <view class="error-icon">âŒ</view>
    <text class="error-message">{{error.message}}</text>
    <button wx:if="{{error.canRetry}}" class="retry-btn" bindtap="onRetryLoad">é‡è¯•</button>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:elif="{{isEmpty}}" class="empty-state">
    <view class="empty-icon">ğŸ“¦</view>
    <text class="empty-message">æš‚æ— æ•°æ®</text>
    <button class="retry-btn" bindtap="onRetryLoad">åˆ·æ–°</button>
  </view>

  <!-- æ­£å¸¸å†…å®¹ -->
  <view wx:else>
    <!-- æœç´¢æ¡† -->
    <view class="search-bar">
      <view class="search-input" bindtap="onSearchTap">
        <text class="search-icon">ğŸ”</text>
        <text class="search-placeholder">æœç´¢å®¶å…·...</text>
      </view>
      <!-- ä¸´æ—¶ç®¡ç†å…¥å£ - é•¿æŒ‰5ç§’æ˜¾ç¤º -->
      <view class="admin-trigger" bindlongpress="onAdminAccess"></view>
    </view>

    <!-- è½®æ’­å›¾ -->
    <swiper class="banner-swiper" indicator-dots="true" autoplay="true" interval="4000" duration="500">
      <swiper-item 
        wx:for="{{banners}}" 
        wx:key="id"
        data-banner="{{item}}"
        bindtap="onBannerTap"
      >
        <image class="banner-image" src="{{item.image}}" mode="aspectFill"></image>
        <view class="banner-overlay">
          <text class="banner-title">{{item.title}}</text>
        </view>
      </swiper-item>
    </swiper>

    <!-- åˆ†ç±»å¯¼èˆª -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">å•†å“åˆ†ç±»</text>
      </view>
      <view class="categories">
        <view 
          wx:for="{{categories}}" 
          wx:key="id" 
          class="cat"
          data-name="{{item.name}}"
          bindtap="onTapCategory"
        >
          <view class="category-icon">{{item.name.charAt(0)}}</view>
          <text class="category-name">{{item.name}}</text>
          <text class="category-count">({{item.count}})</text>
        </view>
      </view>
    </view>

    <!-- å•†å“ç»Ÿè®¡ -->
    <view class="results-summary">
      <text class="results-text">å…± {{totalCount}} ä»¶å•†å“</text>
    </view>

    <!-- çƒ­é—¨å•†å“ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">çƒ­é—¨å•†å“</text>
        <text class="view-more" bindtap="onViewMoreHot">æŸ¥çœ‹æ›´å¤š ></text>
      </view>
      <view class="hot-items">
        <product-card
          wx:for="{{hotItems}}" 
          wx:key="id"
          product="{{item}}"
          card-type="grid"
          show-favorite="{{true}}"
          bind:cardtap="onProductCardTap"
          bind:favoritechange="onFavoriteChange"
        />
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{hotItems.length === 0}}" class="empty-hot-items">
        <text class="empty-text">æš‚æ— çƒ­é—¨å•†å“</text>
      </view>
    </view>
  </view>
</view>
