<!--pages/profile/profile.wxml-->
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <view class="user-section">
    <view class="user-info" bindtap="onGetUserProfile">
      <image 
        class="user-avatar" 
        src="{{userInfo.avatar || '/images/default-avatar.png'}}" 
        mode="aspectFill"
      ></image>
      <view class="user-details">
        <text class="user-nickname">{{userInfo.nickname}}</text>
        <text class="user-phone">{{userInfo.phone || 'ç‚¹å‡»ç™»å½•'}}</text>
      </view>
      <text class="login-arrow">></text>
    </view>
    
    <!-- ç»Ÿè®¡æ•°æ® -->
    <view class="stats-section">
      <view class="stats-item">
        <text class="stats-number">{{statsData.totalOrders}}</text>
        <text class="stats-label">è®¢å•</text>
      </view>
      <view class="stats-item">
        <text class="stats-number">{{statsData.totalFavorites}}</text>
        <text class="stats-label">æ”¶è—</text>
      </view>
      <view class="stats-item">
        <text class="stats-number">{{statsData.totalCompare}}</text>
        <text class="stats-label">å¯¹æ¯”</text>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
  <view class="tabs-section">
    <view class="tabs">
      <view 
        class="tab-item {{currentTab === 'orders' ? 'active' : ''}}"
        data-tab="orders"
        bindtap="onTabChange"
      >
        <text>æˆ‘çš„è®¢å•</text>
      </view>
      <view 
        class="tab-item {{currentTab === 'favorites' ? 'active' : ''}}"
        data-tab="favorites"
        bindtap="onTabChange"
      >
        <text>æ”¶è—å¤¹</text>
      </view>
      <view 
        class="tab-item {{currentTab === 'compare' ? 'active' : ''}}"
        data-tab="compare"
        bindtap="onTabChange"
      >
        <text>å¯¹æ¯”æ </text>
      </view>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content-section">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- è®¢å•åˆ—è¡¨ -->
    <view wx:elif="{{currentTab === 'orders'}}" class="orders-content">
      <view wx:if="{{orders.length === 0}}" class="empty-state">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">æš‚æ— è®¢å•</text>
        <text class="empty-desc">å¿«å»ç§Ÿä¸€äº›å®¶å…·å§</text>
      </view>
      
      <view wx:else class="orders-list">
        <view 
          wx:for="{{orders}}" 
          wx:key="orderId" 
          class="order-item"
          data-order="{{item}}"
          bindtap="onOrderDetail"
        >
          <view class="order-header">
            <text class="order-id">è®¢å•å·ï¼š{{item.orderId}}</text>
            <text class="order-status {{item.status}}">
              {{item.status === 'pending' ? 'å¾…ç¡®è®¤' : item.status === 'confirmed' ? 'å·²ç¡®è®¤' : 'å·²å–æ¶ˆ'}}
            </text>
          </view>
          <view class="order-info">
            <text class="order-sku">å•†å“IDï¼š{{item.skuId}}</text>
            <text class="order-duration">ç§ŸæœŸï¼š{{item.duration}}ä¸ªæœˆ</text>
            <text class="order-amount">é‡‘é¢ï¼šÂ¥{{item.totalAmount}}</text>
          </view>
          <text class="order-date">åˆ›å»ºæ—¶é—´ï¼š{{item.createdAt}}</text>
        </view>
      </view>
    </view>

    <!-- æ”¶è—åˆ—è¡¨ -->
    <view wx:elif="{{currentTab === 'favorites'}}" class="favorites-content">
      <view wx:if="{{favoriteItems.length === 0}}" class="empty-state">
        <text class="empty-icon">ğŸ’</text>
        <text class="empty-text">æš‚æ— æ”¶è—</text>
        <text class="empty-desc">å¿«å»æ”¶è—ä¸€äº›å–œæ¬¢çš„å®¶å…·å§</text>
      </view>
      
      <view wx:else>
        <view class="content-header">
          <text class="content-title">å…±{{favoriteItems.length}}ä»¶æ”¶è—</text>
          <text class="clear-btn" bindtap="onClearFavorites">æ¸…ç©º</text>
        </view>
        <view class="favorites-grid">
          <product-card
            wx:for="{{favoriteItems}}" 
            wx:key="id"
            product="{{item}}"
            card-type="grid"
            show-favorite="{{true}}"
            bind:cardtap="onProductCardTap"
            bind:favoritechange="onFavoriteChange"
          />
        </view>
      </view>
    </view>

    <!-- å¯¹æ¯”åˆ—è¡¨ -->
    <view wx:elif="{{currentTab === 'compare'}}" class="compare-content">
      <view wx:if="{{compareItems.length === 0}}" class="empty-state">
        <text class="empty-icon">âš–ï¸</text>
        <text class="empty-text">æš‚æ— å¯¹æ¯”å•†å“</text>
        <text class="empty-desc">æœ€å¤šå¯å¯¹æ¯”3ä¸ªå•†å“</text>
      </view>
      
      <view wx:else>
        <view class="content-header">
          <text class="content-title">å¯¹æ¯”å•†å“ ({{compareItems.length}}/3)</text>
          <view class="compare-actions">
            <text class="action-btn" bindtap="onStartCompare">å¼€å§‹å¯¹æ¯”</text>
            <text class="clear-btn" bindtap="onClearCompare">æ¸…ç©º</text>
          </view>
        </view>
        <view class="compare-list">
          <product-card
            wx:for="{{compareItems}}" 
            wx:key="id"
            product="{{item}}"
            card-type="list"
            show-favorite="{{false}}"
            show-compare="{{true}}"
            bind:cardtap="onProductCardTap"
            bind:comparechange="onCompareChange"
          />
        </view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section">
    <view class="menu-item" bindtap="onGoToSettings">
      <text class="menu-icon">âš™ï¸</text>
      <text class="menu-text">è®¾ç½®</text>
      <text class="menu-arrow">></text>
    </view>
    
    <view class="menu-item" bindtap="onContactService">
      <text class="menu-icon">ğŸ“</text>
      <text class="menu-text">è”ç³»å®¢æœ</text>
      <text class="menu-arrow">></text>
    </view>
    
    <view class="menu-item" bindtap="onAboutUs">
      <text class="menu-icon">â„¹ï¸</text>
      <text class="menu-text">å…³äºæˆ‘ä»¬</text>
      <text class="menu-arrow">></text>
    </view>
    
    <view wx:if="{{userInfo.nickname !== 'æœªç™»å½•'}}" class="menu-item" bindtap="onLogout">
      <text class="menu-icon">ğŸšª</text>
      <text class="menu-text">é€€å‡ºç™»å½•</text>
      <text class="menu-arrow">></text>
    </view>
  </view>
</view>