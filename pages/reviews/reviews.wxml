<!-- pages/reviews/reviews.wxml -->
<view class="reviews-page">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-left" bindtap="onBack">
      <text class="back-icon">â†</text>
    </view>
    <view class="header-title">
      <text class="title-text">ç”¨æˆ·è¯„ä»·</text>
    </view>
    <view class="header-right">
      <button class="share-btn" open-type="share">
        <text class="share-icon">ğŸ“¤</text>
      </button>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-container">
    <text class="error-icon">âš ï¸</text>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="loadReviews">é‡è¯•</button>
  </view>

  <!-- è¯„ä»·å†…å®¹ -->
  <view wx:else class="reviews-content">
    <!-- å•†å“ä¿¡æ¯ -->
    <view class="product-info">
      <text class="product-name">{{productName}}</text>
      <view class="rating-summary">
        <view class="average-rating">
          <text class="rating-score">{{averageRating}}</text>
          <view class="stars">
            <block wx:for="{{5}}" wx:key="*this">
              <text class="star {{index < Math.floor(averageRating) ? 'filled' : ''}}">â˜…</text>
            </block>
          </view>
        </view>
        <text class="total-count">å…± {{totalCount}} æ¡è¯„ä»·</text>
      </view>
    </view>

    <!-- è¯„åˆ†åˆ†å¸ƒ -->
    <view class="rating-distribution">
      <view class="distribution-item" wx:for="{{[5,4,3,2,1]}}" wx:key="*this">
        <text class="star-label">{{item}}æ˜Ÿ</text>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{ratingDistribution[item]}}%"></view>
        </view>
        <text class="count-label">{{ratingDistribution[item]}}%</text>
      </view>
    </view>

    <!-- è¯„ä»·åˆ—è¡¨ -->
    <view class="reviews-list">
      <view class="review-item" wx:for="{{reviews}}" wx:key="id">
        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <view class="review-header">
          <image class="user-avatar" src="{{item.avatar}}" mode="aspectFill" />
          <view class="user-info">
            <text class="user-name">{{item.user}}</text>
            <view class="review-rating">
              <view class="stars">
                <block wx:for="{{5}}" wx:key="starIndex">
                  <text class="star {{starIndex < item.rating ? 'filled' : ''}}">â˜…</text>
                </block>
              </view>
              <text class="review-date">{{item.date}}</text>
            </view>
          </view>
        </view>

        <!-- è¯„ä»·å†…å®¹ -->
        <view class="review-content">
          <text class="review-text">{{item.content}}</text>
        </view>

        <!-- è¯„ä»·å›¾ç‰‡ -->
        <view wx:if="{{item.images.length > 0}}" class="review-images">
          <image 
            wx:for="{{item.images}}" 
            wx:for-item="image" 
            wx:key="*this"
            class="review-image" 
            src="{{image}}" 
            mode="aspectFill"
            bindtap="onImageTap"
            data-urls="{{item.images}}"
            data-current="{{image}}"
          />
        </view>

        <!-- è¯„ä»·æ“ä½œ -->
        <view class="review-actions">
          <button 
            class="helpful-btn" 
            bindtap="onHelpfulTap" 
            data-id="{{item.id}}"
          >
            <text class="helpful-icon">ğŸ‘</text>
            <text class="helpful-text">æœ‰ç”¨ ({{item.helpful}})</text>
          </button>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{reviews.length === 0}}" class="empty-reviews">
      <text class="empty-icon">ğŸ’¬</text>
      <text class="empty-text">æš‚æ— è¯„ä»·</text>
      <text class="empty-sub">æˆä¸ºç¬¬ä¸€ä¸ªè¯„ä»·çš„ç”¨æˆ·å§ï¼</text>
    </view>
  </view>
</view>
